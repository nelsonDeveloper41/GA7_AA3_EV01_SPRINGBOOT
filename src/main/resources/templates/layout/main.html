<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${titulo != null ? titulo + ' - CartillasAceroWeb' : 'CartillasAceroWeb - SENA'}">CartillasAceroWeb</title>

    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <!-- CSS personalizado -->
    <link th:href="@{/css/estilos.css}" rel="stylesheet">

    <!-- Meta tags adicionales -->
    <meta name="description" content="Sistema de gestión de proyectos - Evidencia SENA GA7-220501096-AA3-EV01">
    <meta name="author" content="Nelson Rodriguez">
    <meta name="keywords" content="SENA, Spring Boot, Thymeleaf, Gestión Proyectos">
</head>
<body>
<!-- Navbar principal -->
<nav th:fragment="navbar" class="navbar navbar-expand-lg navbar-dark bg-primary sticky-top">
    <div class="container">
        <!-- Brand/Logo -->
        <a class="navbar-brand fw-bold" th:href="@{/proyectos}">
            <i class="bi bi-building"></i> CartillasAceroWeb
        </a>

        <!-- Botón toggle para móviles -->
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
            <span class="navbar-toggler-icon"></span>
        </button>

        <!-- Menú de navegación -->
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav me-auto">
                <li class="nav-item">
                    <a class="nav-link" th:href="@{/}"
                       th:classappend="${#httpServletRequest.requestURI == '/' or #httpServletRequest.requestURI == '/inicio' ? 'active' : ''}">
                        <i class="bi bi-house-door"></i> Inicio
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" th:href="@{/proyectos}"
                       th:classappend="${#request.requestURI == '/proyectos' ? 'active' : ''}">
                        <i class="bi bi-list-ul"></i> Lista de Proyectos
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" th:href="@{/proyectos/nuevo}"
                       th:classappend="${#strings.contains(#request.requestURI, '/nuevo') ? 'active' : ''}">
                        <i class="bi bi-plus-circle"></i> Nuevo Proyecto
                    </a>
                </li>
            </ul>

            <!-- Información académica -->
            <span class="navbar-text">
                    <i class="bi bi-mortarboard"></i> SENA - GA7-220501096-AA3-EV01
                </span>
        </div>
    </div>
</nav>

<!-- Área de contenido principal -->
<main class="min-vh-100">
    <!-- Contenedor de mensajes flash -->
    <div th:fragment="mensajes" class="container mt-3">
        <!-- Mensaje de éxito -->
        <div th:if="${exito}" class="alert alert-success alert-dismissible fade show">
            <i class="bi bi-check-circle-fill"></i>
            <span th:text="${exito}">Mensaje de éxito</span>
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>

        <!-- Mensaje de error -->
        <div th:if="${error}" class="alert alert-danger alert-dismissible fade show">
            <i class="bi bi-exclamation-triangle-fill"></i>
            <span th:text="${error}">Mensaje de error</span>
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>

        <!-- Mensaje informativo -->
        <div th:if="${info}" class="alert alert-info alert-dismissible fade show">
            <i class="bi bi-info-circle-fill"></i>
            <span th:text="${info}">Mensaje informativo</span>
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>

        <!-- Mensaje de advertencia -->
        <div th:if="${advertencia}" class="alert alert-warning alert-dismissible fade show">
            <i class="bi bi-exclamation-triangle-fill"></i>
            <span th:text="${advertencia}">Mensaje de advertencia</span>
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
    </div>

    <!-- Contenido específico de cada página -->
    <div th:fragment="contenido">
        <!-- Este fragmento será reemplazado por el contenido de cada vista -->
        <div class="container mt-4">
            <h1>Contenido de la página</h1>
            <p>Este contenido será reemplazado por cada vista específica.</p>
        </div>
    </div>
</main>

<!-- Footer académico -->
<footer th:fragment="footer" class="bg-light border-top mt-auto">
    <div class="container py-4">
        <div class="row">
            <!-- Información institucional -->
            <div class="col-lg-4 mb-3">
                <h6 class="fw-bold text-primary">
                    <i class="bi bi-mortarboard"></i> Información Académica
                </h6>
                <ul class="list-unstyled small text-muted">
                    <li><i class="bi bi-building"></i> <strong>SENA</strong> - Servicio Nacional de Aprendizaje</li>
                    <li><i class="bi bi-book"></i> Análisis y Desarrollo de Software</li>
                    <li><i class="bi bi-file-earmark-code"></i> Evidencia: GA7-220501096-AA3-EV01</li>
                    <li><i class="bi bi-calendar-event"></i> Fase de Ejecución - Julio 2025</li>
                </ul>
            </div>

            <!-- Información técnica -->
            <div class="col-lg-4 mb-3">
                <h6 class="fw-bold text-success">
                    <i class="bi bi-gear"></i> Stack Tecnológico
                </h6>
                <ul class="list-unstyled small text-muted">
                    <li><i class="bi bi-cup-hot"></i> Java 22 + Spring Boot 3.2.0</li>
                    <li><i class="bi bi-database"></i> MySQL 8.0 + Spring Data JPA</li>
                    <li><i class="bi bi-file-earmark-text"></i> Thymeleaf + Bootstrap 5</li>
                    <li><i class="bi bi-tools"></i> Maven + Lombok + DevTools</li>
                </ul>
            </div>

            <!-- Información del desarrollador -->
            <div class="col-lg-4 mb-3">
                <h6 class="fw-bold text-info">
                    <i class="bi bi-person-badge"></i> Desarrollador
                </h6>
                <ul class="list-unstyled small text-muted">
                    <li><i class="bi bi-person"></i> <strong>Nelson Rodriguez</strong></li>
                    <li><i class="bi bi-envelope"></i> Estudiante SENA</li>
                    <li><i class="bi bi-code-square"></i> Versión: 3.0 - Spring Boot</li>
                    <li><i class="bi bi-github"></i> Repositorio: CartillasAceroWeb</li>
                </ul>
            </div>
        </div>

        <!-- Línea de copyright -->
        <hr class="my-3">
        <div class="row align-items-center">
            <div class="col-md-6">
                <small class="text-muted">
                    © 2025 Nelson Rodriguez - SENA. Proyecto Académico.
                </small>
            </div>
            <div class="col-md-6 text-end">
                <small class="text-muted">
                    <i class="bi bi-heart-fill text-danger"></i>
                    Desarrollado con Spring Boot + Thymeleaf
                </small>
            </div>
        </div>
    </div>
</footer>

<!-- Scripts JavaScript -->
<div th:fragment="scripts">
    <!-- Bootstrap 5 JS Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <!-- JavaScript personalizado -->
    <script th:src="@{/js/scripts.js}"></script>

    <!-- Script global para toda la aplicación -->
    <script>
        // Auto-dismiss de alertas después de 5 segundos
        document.addEventListener('DOMContentLoaded', function() {
            const alerts = document.querySelectorAll('.alert:not(.alert-danger)');
            alerts.forEach(function(alert) {
                setTimeout(function() {
                    const bsAlert = new bootstrap.Alert(alert);
                    if (bsAlert) {
                        bsAlert.close();
                    }
                }, 5000);
            });
        });

        // Confirmar navegación si hay formularios con cambios
        let formModificado = false;

        document.addEventListener('DOMContentLoaded', function() {
            const forms = document.querySelectorAll('form');
            forms.forEach(function(form) {
                const initialData = new FormData(form);

                form.addEventListener('input', function() {
                    formModificado = true;
                });

                form.addEventListener('submit', function() {
                    formModificado = false;
                });
            });

            // Warning si hay cambios no guardados
            window.addEventListener('beforeunload', function(e) {
                if (formModificado) {
                    e.preventDefault();
                    e.returnValue = '¿Está seguro de salir? Hay cambios sin guardar.';
                }
            });
        });

        // Función para mostrar notificaciones toast
        function mostrarToast(mensaje, tipo = 'info') {
            const toastContainer = document.getElementById('toast-container') || crearToastContainer();

            const toastElement = document.createElement('div');
            toastElement.className = `toast align-items-center text-bg-${tipo} border-0`;
            toastElement.setAttribute('role', 'alert');

            toastElement.innerHTML = `
                <div class="d-flex">
                    <div class="toast-body">
                        <i class="bi bi-${tipo === 'success' ? 'check-circle' : tipo === 'danger' ? 'exclamation-triangle' : 'info-circle'}"></i>
                        ${mensaje}
                    </div>
                    <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
                </div>
            `;

            toastContainer.appendChild(toastElement);

            const toast = new bootstrap.Toast(toastElement, { delay: 4000 });
            toast.show();

            // Remover elemento después de ocultarse
            toastElement.addEventListener('hidden.bs.toast', function() {
                toastElement.remove();
            });
        }

        function crearToastContainer() {
            const container = document.createElement('div');
            container.id = 'toast-container';
            container.className = 'toast-container position-fixed bottom-0 end-0 p-3';
            document.body.appendChild(container);
            return container;
        }
    </script>
</div>

<!-- Área para scripts específicos de página -->
<div th:fragment="scripts-adicionales">
    <!-- Las páginas individuales pueden agregar scripts específicos aquí -->
</div>

</body>
</html>

<!--
================================================================================
DOCUMENTACIÓN COMPLETA DE main.html (Layout Base)
================================================================================

PROPÓSITO:
----------
Layout base Thymeleaf que proporciona la estructura común para todas las vistas
de la aplicación. Define fragmentos reutilizables (navbar, footer, scripts) y
la estructura HTML base que mantiene consistencia visual y funcional en toda
la aplicación.

INFORMACIÓN ACADÉMICA:
----------------------
Programa:     Análisis y Desarrollo de Software - SENA
Evidencia:    GA7-220501096-AA3-EV01
Tecnología:   Thymeleaf Fragments + Bootstrap 5
Ubicación:    src/main/resources/templates/layout/main.html
Autor:        Nelson Rodriguez

FRAGMENTOS DEFINIDOS:
--------------------

1. ESTRUCTURA COMPLETA:
   - HTML base con meta tags completos
   - Título dinámico según la página
   - Links a CSS y frameworks externos

2. th:fragment="navbar":
   - Navbar Bootstrap responsivo
   - Menú de navegación con links activos
   - Brand/logo con enlace a inicio
   - Información académica visible
   - Collapse menu para móviles

3. th:fragment="mensajes":
   - Sistema completo de mensajes flash
   - 4 tipos: éxito, error, info, advertencia
   - Auto-dismiss y botones de cierre
   - Iconos contextuales

4. th:fragment="contenido":
   - Área principal para contenido específico
   - Container Bootstrap para layout consistente
   - Placeholder que será reemplazado

5. th:fragment="footer":
   - Footer académico completo
   - Información institucional del SENA
   - Stack tecnológico implementado
   - Datos del desarrollador
   - Copyright y versión

6. th:fragment="scripts":
   - Bootstrap JS bundle
   - Scripts personalizados globales
   - Funciones JavaScript reutilizables
   - Auto-dismiss de alertas

7. th:fragment="scripts-adicionales":
   - Área para scripts específicos de página
   - Extensibilidad para funcionalidades particulares

USO EN OTRAS VISTAS:
-------------------

Las vistas pueden usar este layout de varias formas:

1. INCLUIR FRAGMENTOS ESPECÍFICOS:
```html
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="layout/main :: head"></head>
<body>
    <nav th:replace="layout/main :: navbar"></nav>

    <main>
        <div th:replace="layout/main :: mensajes"></div>
        <!-- Contenido específico de la página -->
</main>

<footer th:replace="layout/main :: footer"></footer>
<div th:replace="layout/main :: scripts"></div>
</body>
</html>
```

2. USAR LAYOUT COMPLETO CON REEMPLAZO:
```html
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" th:replace="layout/main">
<body>
<div th:fragment="contenido">
    <!-- Contenido específico aquí -->
</div>
</body>
</html>
```

CARACTERÍSTICAS DEL NAVBAR:
---------------------------

1. NAVEGACIÓN INTELIGENTE:
- Links activos automáticos basados en URL
- Responsive collapse para móviles
- Brand clickeable que va a inicio

2. ELEMENTOS INCLUIDOS:
- Lista de Proyectos (con indicador activo)
- Nuevo Proyecto (con indicador activo)
- Información académica de la evidencia

3. CLASES BOOTSTRAP:
- navbar-dark bg-primary: Tema azul oscuro
- sticky-top: Se mantiene fijo arriba
- container: Centrado y responsive

SISTEMA DE MENSAJES:
-------------------

1. TIPOS DE MENSAJES:
- ${exito}: alert-success (verde)
- ${error}: alert-danger (rojo)
- ${info}: alert-info (azul)
- ${advertencia}: alert-warning (amarillo)

2. CARACTERÍSTICAS:
- Auto-dismissible con botón X
- Iconos Bootstrap apropiados
- Fade in/out automático
- Auto-dismiss después de 5 segundos (excepto errores)

FOOTER ACADÉMICO:
----------------

1. INFORMACIÓN INSTITUCIONAL:
- Datos completos del SENA
- Programa de formación
- Código de evidencia
- Fase de proyecto

2. STACK TECNOLÓGICO:
- Versiones exactas de tecnologías
- Frameworks utilizados
- Herramientas de desarrollo

3. DESARROLLADOR:
- Información del estudiante
- Versión del proyecto
- Referencias del repositorio

JAVASCRIPT GLOBAL:
-----------------

1. AUTO-DISMISS DE ALERTAS:
- Mensajes no críticos se ocultan automáticamente
- Errores permanecen hasta cierre manual
- Transiciones suaves

2. DETECCIÓN DE CAMBIOS EN FORMULARIOS:
- Warning antes de salir si hay cambios
- Prevención de pérdida de datos
- Reset al enviar formulario

3. SISTEMA DE TOASTS:
- Función mostrarToast() global
- Notificaciones no intrusivas
- Tipos: success, danger, info
- Auto-posicionamiento y limpieza

RESPONSIVIDAD:
-------------

1. BREAKPOINTS:
- Mobile-first design
- Navbar collapse en pantallas pequeñas
- Footer adaptable con columnas flexibles
- Containers Bootstrap responsive

2. COMPONENTES ADAPTATIVOS:
- Menús que se convierten en hamburger
- Footer que apila columnas en móviles
- Alertas que se adaptan al ancho

META TAGS Y SEO:
---------------

1. META TAGS BÁSICOS:
- Charset UTF-8 para caracteres especiales
- Viewport responsive
- Description para motores de búsqueda

2. META TAGS ACADÉMICOS:
- Author: Nelson Rodriguez
- Keywords: SENA, Spring Boot, etc.
- Description específica del proyecto

EXTENSIBILIDAD:
--------------

1. CSS PERSONALIZADO:
- Link a /css/estilos.css
- Sobrescribe estilos de Bootstrap
- Temas personalizados

2. SCRIPTS ADICIONALES:
- Fragmento scripts-adicionales
- Cada vista puede agregar JS específico
- Orden de carga controlado

3. CONTENIDO DINÁMICO:
- Títulos variables según página
- Navegación activa automática
- Mensajes contextuales

INTEGRACIÓN CON SPRING BOOT:
---------------------------

1. THYMELEAF EXPRESSIONS:
- @{/ruta}: URLs absolutas
- ${variable}: Variables del modelo
- #request.requestURI: Información de request

2. FRAGMENT REPLACEMENT:
- th:replace: Reemplaza completamente
- th:insert: Inserta dentro del elemento
- th:include: Incluye solo el contenido

3. CONDICIONALES:
- th:if: Mostrar si existe variable
- th:classappend: CSS condicional
- th:text: Contenido dinámico

BENEFICIOS DEL LAYOUT:
---------------------

1. CONSISTENCIA:
- Mismo navbar en todas las páginas
- Footer uniforme
- Mensajes estandarizados

2. MANTENIBILIDAD:
- Cambios centralizados
- Un solo lugar para scripts globales
- Estructura reutilizable

3. PERFORMANCE:
- Carga única de recursos comunes
- Fragmentos cacheable
- Scripts optimizados

4. UX UNIFORME:
- Navegación predecible
- Mensajes consistentes
- Comportamiento estándar

EVIDENCIA DE COMPETENCIAS:
-------------------------
1. 🎯 Dominio de Thymeleaf fragments
2. 🏗️ Arquitectura de templates modular
3. 💾 Integración completa con Spring MVC
4. 📝 Responsive design con Bootstrap
5. 🔧 JavaScript modular y reutilizable
6. 🧪 Sistema de mensajes robusto
7. 📊 Layout académico profesional

MEJORES PRÁCTICAS IMPLEMENTADAS:
-------------------------------
- Separación de concerns (estructura, estilo, comportamiento)
- Fragmentos reutilizables y modulares
- Meta tags completos para SEO
- JavaScript no intrusivo
- Accesibilidad con roles y labels apropiados
- Performance optimizado con CDNs
- Estructura semántica HTML5

AUTOR: Nelson Rodriguez
EVIDENCIA: GA7-220501096-AA3-EV01
FECHA: 2025-07-07
VERSIÓN: 3.0 (Thymeleaf Layout System)

===============================================================================