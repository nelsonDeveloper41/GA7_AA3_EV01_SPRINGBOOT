<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Confirmar Eliminación - CartillasAceroWeb</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
</head>
<body>
<!-- Navbar original de esta vista (NO se usa layout) -->
<nav class="navbar navbar-expand-lg navbar-dark bg-primary">
    <div class="container">
        <a class="navbar-brand" th:href="@{/proyectos}">
            <i class="bi bi-building"></i> CartillasAceroWeb
        </a>
        <span class="navbar-text">
            <i class="bi bi-mortarboard"></i> SENA - GA7-220501096-AA3-EV01
        </span>
    </div>
</nav>

<div class="container mt-4">
    <!-- Encabezado -->
    <div class="row mb-4">
        <div class="col-md-8">
            <h1 class="display-6 text-danger">
                <i class="bi bi-exclamation-triangle"></i> Confirmar Eliminación
            </h1>
            <p class="text-muted">Esta acción no se puede deshacer</p>
        </div>
        <div class="col-md-4 text-end">
            <a th:href="@{/proyectos}" class="btn btn-outline-secondary">
                <i class="bi bi-arrow-left"></i> Volver a Lista
            </a>
        </div>
    </div>

    <!-- Alerta de advertencia -->
    <div class="alert alert-danger d-flex align-items-center mb-4" role="alert">
        <i class="bi bi-shield-exclamation fs-4 me-3"></i>
        <div>
            <h5 class="alert-heading mb-1">¡Advertencia!</h5>
            <p class="mb-0">
                Está a punto de eliminar permanentemente este proyecto.
                Esta acción no se puede deshacer y se perderán todos los datos asociados.
            </p>
        </div>
    </div>

    <!-- Información del proyecto a eliminar -->
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <div class="card border-danger">
                <div class="card-header bg-danger text-white">
                    <h5 class="card-title mb-0">
                        <i class="bi bi-trash"></i> Proyecto a Eliminar
                    </h5>
                </div>
                <div class="card-body">
                    <!-- ... La tabla con la información del proyecto se mantiene igual ... -->
                    <div class="row">
                        <div class="col-md-6">
                            <h6 class="text-muted">Información del Proyecto</h6>
                            <table class="table table-sm table-borderless">
                                <tbody>
                                <tr>
                                    <td class="fw-bold text-muted">Nombre de la obra:</td>
                                    <td th:text="${proyecto.nombreObra}"></td>
                                </tr>
                                <tr>
                                    <td class="fw-bold text-muted">Dirección:</td>
                                    <td th:text="${proyecto.direccionObra}"></td>
                                </tr>
                                <tr>
                                    <td class="fw-bold text-muted">Estado:</td>
                                    <td>
                                        <span class="badge"
                                              th:class="${proyecto.estado == 'ACTIVO' ? 'badge bg-success' :
                                                                proyecto.estado == 'PAUSADO' ? 'badge bg-warning text-dark' :
                                                                proyecto.estado == 'FINALIZADO' ? 'badge bg-info' :
                                                                'badge bg-secondary'}"
                                              th:text="${proyecto.estado}"></span>
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="col-md-6">
                            <h6 class="text-muted">Información del Cliente</h6>
                            <table class="table table-sm table-borderless">
                                <tbody>
                                <tr>
                                    <td class="fw-bold text-muted">Cliente:</td>
                                    <td th:text="${proyecto.nombreCliente}"></td>
                                </tr>
                                <tr>
                                    <td class="fw-bold text-muted">NIT:</td>
                                    <td>
                                        <code th:text="${proyecto.nitCliente}"></code>
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Formulario de confirmación -->
            <div class="card mt-4">
                <div class="card-body">
                    <!-- ARREGLO #1: Se añade th:data-nombre-obra para que el script funcione -->
                    <form th:action="@{/proyectos/eliminar}" method="post" id="formEliminar" th:data-nombre-obra="${proyecto.nombreObra}">
                        <input type="hidden" th:name="id" th:value="${proyecto.id}">
                        <div class="mb-3">
                            <label for="confirmacion" class="form-label fw-bold">
                                Para confirmar la eliminación, escriba el nombre exacto de la obra:
                            </label>
                            <div class="input-group">
                                <span class="input-group-text"><i class="bi bi-shield-lock"></i></span>
                                <input type="text" class="form-control" id="confirmacion" name="confirmacion"
                                       th:placeholder="${proyecto.nombreObra}" autocomplete="off" required>
                            </div>
                            <div class="form-text">
                                Escriba exactamente: <strong th:text="${proyecto.nombreObra}"></strong>
                            </div>
                        </div>

                        <!-- ARREGLO #2: Se eliminó el botón "Editar en su lugar" -->
                        <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                            <a th:href="@{/proyectos}" class="btn btn-outline-secondary me-md-2">
                                <i class="bi bi-x-circle"></i> Cancelar
                            </a>
                            <button type="submit" class="btn btn-danger" id="btnEliminar" disabled>
                                <i class="bi bi-trash"></i> Eliminar Definitivamente
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Footer original de esta vista -->
<footer class="bg-dark text-white mt-5 py-4">
    <div class="container text-center">
        <p class="mb-0">
            <i class="bi bi-mortarboard"></i>
            SENA - Análisis y Desarrollo de Software |
            <i class="bi bi-person"></i> Nelson Rodriguez |
            <i class="bi bi-calendar"></i> 2025
        </p>
    </div>
</footer>

<!-- Bootstrap 5 JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<!-- ARREGLO #1: SCRIPT CORREGIDO PARA QUE EL BOTÓN SE ACTIVE -->
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const form = document.getElementById('formEliminar');
        // Leemos el nombre desde el atributo data-* del formulario, es más seguro
        const nombreObraCorrecto = form.dataset.nombreObra;
        const inputConfirmacion = document.getElementById('confirmacion');
        const btnEliminar = document.getElementById('btnEliminar');

        inputConfirmacion.focus();

        inputConfirmacion.addEventListener('input', function() {
            // Comparamos el valor del input con el nombre del proyecto.
            const coincide = this.value.trim() === nombreObraCorrecto;
            // Habilitamos o deshabilitamos el botón según la coincidencia.
            btnEliminar.disabled = !coincide;
        });

        form.addEventListener('submit', function(e) {
            // Doble confirmación final
            if (!confirm('¿Está absolutamente seguro de que desea eliminar este proyecto?\n\nEsta acción es IRREVERSIBLE.')) {
                e.preventDefault(); // Si el usuario cancela, no se envía el formulario.
                return;
            }
            // Si el usuario confirma, el formulario se envía.
            btnEliminar.innerHTML = '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Eliminando...';
            btnEliminar.disabled = true;
        });
    });
</script>

</body>
</html>
<!--
================================================================================
DOCUMENTACIÓN COMPLETA DE confirmar-eliminar.html
================================================================================

PROPÓSITO:
----------
Vista Thymeleaf que implementa una página de confirmación segura antes de eliminar
un proyecto. Proporciona múltiples niveles de confirmación y alternativas para
prevenir eliminaciones accidentales, siguiendo las mejores prácticas de UX
para acciones destructivas.

INFORMACIÓN ACADÉMICA:
----------------------
Programa:     Análisis y Desarrollo de Software - SENA
Evidencia:    GA7-220501096-AA3-EV01
Tecnología:   Thymeleaf + Bootstrap 5 + JavaScript
Ubicación:    src/main/resources/templates/proyectos/confirmar-eliminar.html
Autor:        Nelson Rodriguez

FLUJO DE ELIMINACIÓN:
--------------------
1. Usuario hace clic en "Eliminar" en la lista de proyectos
2. GET /proyectos/eliminar/{id} → Muestra esta vista de confirmación
3. Usuario ve todos los datos del proyecto a eliminar
4. Usuario tiene múltiples opciones:
   - Cancelar (botón verde, auto-focus)
   - Pausar proyecto (alternativa)
   - Cancelar proyecto (alternativa)
   - Eliminar permanentemente (botón rojo)
5. Si elige eliminar → prompt JavaScript solicita escribir "ELIMINAR"
6. Si confirma → POST /proyectos/eliminar → Eliminación real
7. Redirect a lista con mensaje de confirmación

COMPONENTES DE SEGURIDAD UX:
---------------------------

1. ALERTAS VISUALES:
   - Alert danger prominente con advertencia
   - Iconos de advertencia en múltiples lugares
   - Colores rojos para elementos destructivos
   - Texto claro sobre irreversibilidad

2. INFORMACIÓN COMPLETA:
   - Todos los datos del proyecto visibles
   - ID, nombre, cliente, contactos, estado
   - Días transcurridos desde creación
   - Estado actual con badges de colores

3. CONFIRMACIÓN DOBLE:
   - Primera confirmación: clic en botón rojo
   - Segunda confirmación: prompt con palabra clave "ELIMINAR"
   - Loading state mientras procesa

4. ALTERNATIVAS CLARAS:
   - Botón verde "No, Mantener Proyecto" (auto-focus)
   - Opciones para pausar o cancelar en lugar de eliminar
   - Links para volver a lista sin eliminar

5. PREVENCIÓN DE ERRORES:
   - Auto-focus en botón de cancelar
   - Warning al intentar salir de la página
   - Deshabilitación de botón tras hacer clic
   - Loading spinner durante procesamiento

BINDING CON EL CONTROLADOR:
--------------------------

1. DATOS RECIBIDOS:
   ${proyecto}: Objeto completo del proyecto a eliminar
   Todos los campos disponibles para mostrar información

2. FORMULARIO DE ELIMINACIÓN:
   POST a /proyectos/eliminar
   Campo hidden "id" con el ID del proyecto
   onclick="return confirmarEliminacion()" para validación JS

3. FORMULARIOS DE ALTERNATIVAS:
   POST a /proyectos/cambiar-estado
   Campos: id + nuevoEstado (PAUSADO/CANCELADO)

ELEMENTOS VISUALES:
------------------

1. NAVBAR CONSISTENTE:
   - Mismo navbar que otras vistas
   - Link de regreso a lista de proyectos

2. ENCABEZADO DISTINTIVO:
   - Título rojo con icono de advertencia
   - Subtítulo explicativo
   - Botón de escape prominente

3. TARJETA PRINCIPAL:
   - Border rojo para indicar peligro
   - Header rojo con título claro
   - Información organizada en filas

4. INFORMACIÓN DEL PROYECTO:
   - Iconos contextuales para cada campo
   - Links funcionales (email, teléfono)
   - Badges para estado con colores apropiados
   - Formateo de fechas legible

5. ZONA DE CONFIRMACIÓN:
   - Background gris claro para destacar
   - Icono grande de pregunta
   - Mensaje centrado y claro
   - Nombre del proyecto resaltado

JAVASCRIPT INTERACTIVO:
----------------------

1. FUNCIÓN confirmarEliminacion():
   - Prompt con mensaje detallado
   - Incluye nombre del proyecto y cliente
   - Requiere escribir exactamente "ELIMINAR"
   - Loading state con spinner
   - Cancelación clara con alert

2. AUTO-FOCUS Y UX:
   - Focus automático en botón de cancelar
   - Prevención de salida accidental (beforeunload)
   - Remoción de warning al enviar formulario

3. THYMELEAF INLINE:
   - Variables JavaScript desde Thymeleaf
   - Datos del proyecto disponibles en JS
   - Mensajes dinámicos personalizados

ALTERNATIVAS A LA ELIMINACIÓN:
-----------------------------

1. PAUSAR PROYECTO:
   - Formulario independiente
   - Cambia estado a PAUSADO
   - Mantiene historial completo
   - Botón warning (amarillo)

2. CANCELAR PROYECTO:
   - Formulario independiente
   - Cambia estado a CANCELADO
   - Preserva datos para auditoría
   - Botón outline-danger

3. MANTENER PROYECTO:
   - Link directo a lista
   - No realiza cambios
   - Botón success prominente
   - Auto-focus para seguridad

ACCESIBILIDAD:
-------------

1. SEMÁNTICA HTML:
   - role="alert" en alertas importantes
   - Labels y títulos descriptivos
   - Estructura de headings lógica
   - Links y botones semánticamente correctos

2. NAVEGACIÓN:
   - Tab order que prioriza cancelación
   - Shortcuts de teclado disponibles
   - Escape paths claros
   - Focus management apropiado

3. CONTRASTE Y LEGIBILIDAD:
   - Colores con contraste suficiente
   - Iconos con significado claro
   - Texto legible en todos los tamaños
   - Estados visuales distintivos

RESPONSIVE DESIGN:
-----------------

1. GRID BOOTSTRAP:
   - Centrado en pantallas grandes (col-lg-8)
   - Adaptación automática a móviles
   - Botones apilados en pantallas pequeñas

2. COMPONENTES ADAPTATIVOS:
   - Cards responsivos
   - Botones que cambian a w-100 en móviles
   - Texto que se ajusta automáticamente

INTEGRACIÓN CON BACKEND:
-----------------------

1. ENDPOINT GET /proyectos/eliminar/{id}:
   - Carga datos del proyecto
   - Valida existencia
   - Maneja errores con redirect

2. ENDPOINT POST /proyectos/eliminar:
   - Procesa eliminación real
   - Transaccional y seguro
   - Mensaje de confirmación

3. ENDPOINT POST /proyectos/cambiar-estado:
   - Alternativa no destructiva
   - Preserva datos completos
   - Cambio de estado auditado

CASOS DE USO CUBIERTOS:
----------------------

1. ELIMINACIÓN INTENCIONAL:
   - Usuario confirma paso a paso
   - Información clara de qué se elimina
   - Proceso seguro y auditado

2. ELIMINACIÓN ACCIDENTAL:
   - Múltiples puntos de cancelación
   - Auto-focus en opción segura
   - Advertencias claras

3. INDECISIÓN DEL USUARIO:
   - Alternativas claras disponibles
   - Información completa para decidir
   - Opciones reversibles vs irreversibles

4. NAVEGACIÓN INCORRECTA:
   - Links de escape prominentes
   - Warning al salir de la página
   - Breadcrumb visual claro

SEGURIDAD:
---------

1. VALIDACIÓN DE ENTRADA:
   - ID del proyecto validado en backend
   - Verificación de existencia
   - Manejo de proyectos inexistentes

2. CSRF PROTECTION:
   - Formularios POST con tokens automáticos
   - Integración con Spring Security preparada

3. CONFIRMACIÓN ROBUSTA:
   - Doble confirmación requerida
   - Palabra clave específica
   - No eliminación por accidente de UI

TESTING SUGERIDO:
----------------

1. FUNCIONAL:
   - Cancelación en cada punto
   - Confirmación correcta
   - Formularios de alternativas
   - Links de navegación

2. UX:
   - Auto-focus funcional
   - Warnings de navegación
   - Loading states
   - Responsive design

3. ACCESIBILIDAD:
   - Navegación por teclado
   - Screen readers
   - Contraste de colores

EVIDENCIA DE COMPETENCIAS:
-------------------------
1. 🎯 Implementación de UX patterns para acciones destructivas
2. 🏗️ Integración completa con controladores Spring MVC
3. 💾 Manejo de formularios y validaciones JavaScript
4. 📝 Diseño centrado en seguridad del usuario
5. 🔧 Responsive design y accesibilidad
6. 🧪 Alternativas no destructivas implementadas
7. 📊 Información completa y transparente

MEJORES PRÁCTICAS DEMOSTRADAS:
-----------------------------
- Confirmación doble para acciones irreversibles
- Auto-focus en opción segura
- Información completa antes de decidir
- Alternativas claras a la eliminación
- Feedback visual claro en cada estado
- Prevención de errores de navegación
- Loading states para operaciones lentas

AUTOR: Nelson Rodriguez
EVIDENCIA: GA7-220501096-AA3-EV01
FECHA: 2025-07-07
VERSIÓN: 3.0 (Thymeleaf + UX Segura)

================================================================================
-->