<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Confirmar Eliminaci√≥n - CartillasAceroWeb</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
</head>
<body>
<!-- Navbar original de esta vista (NO se usa layout) -->
<nav class="navbar navbar-expand-lg navbar-dark bg-primary">
    <div class="container">
        <a class="navbar-brand" th:href="@{/proyectos}">
            <i class="bi bi-building"></i> CartillasAceroWeb
        </a>
        <span class="navbar-text">
            <i class="bi bi-mortarboard"></i> SENA - GA7-220501096-AA3-EV01
        </span>
    </div>
</nav>

<div class="container mt-4">
    <!-- Encabezado -->
    <div class="row mb-4">
        <div class="col-md-8">
            <h1 class="display-6 text-danger">
                <i class="bi bi-exclamation-triangle"></i> Confirmar Eliminaci√≥n
            </h1>
            <p class="text-muted">Esta acci√≥n no se puede deshacer</p>
        </div>
        <div class="col-md-4 text-end">
            <a th:href="@{/proyectos}" class="btn btn-outline-secondary">
                <i class="bi bi-arrow-left"></i> Volver a Lista
            </a>
        </div>
    </div>

    <!-- Alerta de advertencia -->
    <div class="alert alert-danger d-flex align-items-center mb-4" role="alert">
        <i class="bi bi-shield-exclamation fs-4 me-3"></i>
        <div>
            <h5 class="alert-heading mb-1">¬°Advertencia!</h5>
            <p class="mb-0">
                Est√° a punto de eliminar permanentemente este proyecto.
                Esta acci√≥n no se puede deshacer y se perder√°n todos los datos asociados.
            </p>
        </div>
    </div>

    <!-- Informaci√≥n del proyecto a eliminar -->
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <div class="card border-danger">
                <div class="card-header bg-danger text-white">
                    <h5 class="card-title mb-0">
                        <i class="bi bi-trash"></i> Proyecto a Eliminar
                    </h5>
                </div>
                <div class="card-body">
                    <!-- ... La tabla con la informaci√≥n del proyecto se mantiene igual ... -->
                    <div class="row">
                        <div class="col-md-6">
                            <h6 class="text-muted">Informaci√≥n del Proyecto</h6>
                            <table class="table table-sm table-borderless">
                                <tbody>
                                <tr>
                                    <td class="fw-bold text-muted">Nombre de la obra:</td>
                                    <td th:text="${proyecto.nombreObra}"></td>
                                </tr>
                                <tr>
                                    <td class="fw-bold text-muted">Direcci√≥n:</td>
                                    <td th:text="${proyecto.direccionObra}"></td>
                                </tr>
                                <tr>
                                    <td class="fw-bold text-muted">Estado:</td>
                                    <td>
                                        <span class="badge"
                                              th:class="${proyecto.estado == 'ACTIVO' ? 'badge bg-success' :
                                                                proyecto.estado == 'PAUSADO' ? 'badge bg-warning text-dark' :
                                                                proyecto.estado == 'FINALIZADO' ? 'badge bg-info' :
                                                                'badge bg-secondary'}"
                                              th:text="${proyecto.estado}"></span>
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="col-md-6">
                            <h6 class="text-muted">Informaci√≥n del Cliente</h6>
                            <table class="table table-sm table-borderless">
                                <tbody>
                                <tr>
                                    <td class="fw-bold text-muted">Cliente:</td>
                                    <td th:text="${proyecto.nombreCliente}"></td>
                                </tr>
                                <tr>
                                    <td class="fw-bold text-muted">NIT:</td>
                                    <td>
                                        <code th:text="${proyecto.nitCliente}"></code>
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Formulario de confirmaci√≥n -->
            <div class="card mt-4">
                <div class="card-body">
                    <!-- ARREGLO #1: Se a√±ade th:data-nombre-obra para que el script funcione -->
                    <form th:action="@{/proyectos/eliminar}" method="post" id="formEliminar" th:data-nombre-obra="${proyecto.nombreObra}">
                        <input type="hidden" th:name="id" th:value="${proyecto.id}">
                        <div class="mb-3">
                            <label for="confirmacion" class="form-label fw-bold">
                                Para confirmar la eliminaci√≥n, escriba el nombre exacto de la obra:
                            </label>
                            <div class="input-group">
                                <span class="input-group-text"><i class="bi bi-shield-lock"></i></span>
                                <input type="text" class="form-control" id="confirmacion" name="confirmacion"
                                       th:placeholder="${proyecto.nombreObra}" autocomplete="off" required>
                            </div>
                            <div class="form-text">
                                Escriba exactamente: <strong th:text="${proyecto.nombreObra}"></strong>
                            </div>
                        </div>

                        <!-- ARREGLO #2: Se elimin√≥ el bot√≥n "Editar en su lugar" -->
                        <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                            <a th:href="@{/proyectos}" class="btn btn-outline-secondary me-md-2">
                                <i class="bi bi-x-circle"></i> Cancelar
                            </a>
                            <button type="submit" class="btn btn-danger" id="btnEliminar" disabled>
                                <i class="bi bi-trash"></i> Eliminar Definitivamente
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Footer original de esta vista -->
<footer class="bg-dark text-white mt-5 py-4">
    <div class="container text-center">
        <p class="mb-0">
            <i class="bi bi-mortarboard"></i>
            SENA - An√°lisis y Desarrollo de Software |
            <i class="bi bi-person"></i> Nelson Rodriguez |
            <i class="bi bi-calendar"></i> 2025
        </p>
    </div>
</footer>

<!-- Bootstrap 5 JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<!-- ARREGLO #1: SCRIPT CORREGIDO PARA QUE EL BOT√ìN SE ACTIVE -->
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const form = document.getElementById('formEliminar');
        // Leemos el nombre desde el atributo data-* del formulario, es m√°s seguro
        const nombreObraCorrecto = form.dataset.nombreObra;
        const inputConfirmacion = document.getElementById('confirmacion');
        const btnEliminar = document.getElementById('btnEliminar');

        inputConfirmacion.focus();

        inputConfirmacion.addEventListener('input', function() {
            // Comparamos el valor del input con el nombre del proyecto.
            const coincide = this.value.trim() === nombreObraCorrecto;
            // Habilitamos o deshabilitamos el bot√≥n seg√∫n la coincidencia.
            btnEliminar.disabled = !coincide;
        });

        form.addEventListener('submit', function(e) {
            // Doble confirmaci√≥n final
            if (!confirm('¬øEst√° absolutamente seguro de que desea eliminar este proyecto?\n\nEsta acci√≥n es IRREVERSIBLE.')) {
                e.preventDefault(); // Si el usuario cancela, no se env√≠a el formulario.
                return;
            }
            // Si el usuario confirma, el formulario se env√≠a.
            btnEliminar.innerHTML = '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Eliminando...';
            btnEliminar.disabled = true;
        });
    });
</script>

</body>
</html>
<!--
<!--
================================================================================
DOCUMENTACI√ìN COMPLETA DE confirmar-eliminar.html
================================================================================

PROP√ìSITO:
----------
Vista Thymeleaf que implementa una p√°gina de confirmaci√≥n segura antes de eliminar
un proyecto. Esta vista corresponde a la operaci√≥n "Delete" (Borrar) del CRUD,
a√±adiendo una capa de seguridad crucial para prevenir la p√©rdida accidental de datos.
El dise√±o se centra en la claridad y la prevenci√≥n de errores.

INFORMACI√ìN ACAD√âMICA:
----------------------
Programa:     An√°lisis y Desarrollo de Software - SENA
Evidencia:    GA7-220501096-AA3-EV01
Tecnolog√≠a:   Thymeleaf + Bootstrap 5 + JavaScript
Ubicaci√≥n:    src/main/resources/templates/proyectos/confirmar-eliminar.html
Autor:        Nelson Rodriguez

FLUJO DE ELIMINACI√ìN IMPLEMENTADO:
----------------------------------
1. El usuario hace clic en el √≠cono de "Eliminar" en la lista de proyectos.
2. Es dirigido a esta p√°gina (GET /proyectos/eliminar/{id}).
3. La vista muestra los detalles del proyecto a eliminar y una advertencia clara.
4. Para proceder, el usuario DEBE escribir el nombre exacto de la obra en un campo de texto.
5. Solo cuando el nombre coincide, el bot√≥n "Eliminar Definitivamente" se habilita.
6. Al hacer clic, una √∫ltima alerta de confirmaci√≥n (`confirm()`) aparece como barrera final.
7. Si se confirma, se env√≠a la petici√≥n (POST /proyectos/eliminar) para borrar el registro.
8. El sistema redirige a la lista de proyectos con un mensaje de √©xito.

COMPONENTES DE SEGURIDAD Y UX:
------------------------------

1. **VALIDACI√ìN POR COINCIDENCIA DE NOMBRE:**
   - Impide la eliminaci√≥n por clics accidentales. El usuario debe realizar un esfuerzo
     consciente (escribir el nombre) para habilitar la acci√≥n destructiva.

2. **FEEDBACK VISUAL INMEDIATO:**
   - El script de JavaScript valida en tiempo real si el nombre introducido es correcto,
     habilitando/deshabilitando el bot√≥n de inmediato.

3. **DISE√ëO CENTRADO EN LA ACCI√ìN:**
   - Se eliminaron botones de acciones alternativas (como "Editar en su lugar") para no
     distraer al usuario. El flujo es simple: o se elimina, o se cancela.

4. **ADVERTENCIAS VISUALES CLARAS:**
   - Uso intensivo del color rojo, √≠conos de advertencia (`bi-exclamation-triangle`) y
     alertas de Bootstrap para comunicar el peligro de la acci√≥n.

5. **CONFIRMACI√ìN FINAL:**
   - Un `confirm()` de JavaScript act√∫a como la √∫ltima oportunidad para que el usuario
     cancele la operaci√≥n antes de que sea irreversible.

BINDING CON EL CONTROLADOR:
--------------------------

1. **DATOS RECIBIDOS:**
   - `${proyecto}`: Objeto `Proyecto` completo, pasado desde el controlador para
     mostrar los datos y para la validaci√≥n en el script.

2. **FORMULARIO DE ELIMINACI√ìN:**
   - Env√≠a una petici√≥n `POST` a `/proyectos/eliminar`.
   - Incluye el `id` del proyecto en un campo oculto.
   - Usa un atributo `th:data-nombre-obra` para pasar el nombre del proyecto al
     script de forma segura, evitando problemas de codificaci√≥n.

JAVASCRIPT INTERACTIVO:
-----------------------

1. **HABILITACI√ìN DIN√ÅMICA DE BOT√ìN:**
   - El script compara el valor del `input` con el nombre correcto del proyecto
     (obtenido del atributo `data-nombre-obra`).
   - El bot√≥n `btnEliminar` cambia su estado `disabled` basado en el resultado.

2. **AUTO-FOCUS:**
   - Se hace foco autom√°ticamente en el campo de confirmaci√≥n para mejorar la
     experiencia de usuario y guiar la siguiente acci√≥n.

EVIDENCIA DE COMPETENCIAS:
-------------------------
1. üéØ Implementaci√≥n de patrones de UX seguros para acciones destructivas.
2. üèóÔ∏è Integraci√≥n efectiva entre el controlador Spring MVC y la vista Thymeleaf.
3. üíæ Manejo de formularios y validaciones en el lado del cliente con JavaScript.
4. üìù Dise√±o de interfaz claro y enfocado, eliminando distracciones.
5. üîß Uso de atributos `data-*` para una comunicaci√≥n segura entre Thymeleaf y JavaScript.

================================================================================
-->