<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Confirmar Eliminaci√≥n - CartillasAceroWeb</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
</head>
<body>
<!-- Navbar original de esta vista (NO se usa layout) -->
<nav class="navbar navbar-expand-lg navbar-dark bg-primary">
    <div class="container">
        <a class="navbar-brand" th:href="@{/proyectos}">
            <i class="bi bi-building"></i> CartillasAceroWeb
        </a>
        <span class="navbar-text">
            <i class="bi bi-mortarboard"></i> SENA - GA7-220501096-AA3-EV01
        </span>
    </div>
</nav>

<div class="container mt-4">
    <!-- Encabezado -->
    <div class="row mb-4">
        <div class="col-md-8">
            <h1 class="display-6 text-danger">
                <i class="bi bi-exclamation-triangle"></i> Confirmar Eliminaci√≥n
            </h1>
            <p class="text-muted">Esta acci√≥n no se puede deshacer</p>
        </div>
        <div class="col-md-4 text-end">
            <a th:href="@{/proyectos}" class="btn btn-outline-secondary">
                <i class="bi bi-arrow-left"></i> Volver a Lista
            </a>
        </div>
    </div>

    <!-- Alerta de advertencia -->
    <div class="alert alert-danger d-flex align-items-center mb-4" role="alert">
        <i class="bi bi-shield-exclamation fs-4 me-3"></i>
        <div>
            <h5 class="alert-heading mb-1">¬°Advertencia!</h5>
            <p class="mb-0">
                Est√° a punto de eliminar permanentemente este proyecto.
                Esta acci√≥n no se puede deshacer y se perder√°n todos los datos asociados.
            </p>
        </div>
    </div>

    <!-- Informaci√≥n del proyecto a eliminar -->
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <div class="card border-danger">
                <div class="card-header bg-danger text-white">
                    <h5 class="card-title mb-0">
                        <i class="bi bi-trash"></i> Proyecto a Eliminar
                    </h5>
                </div>
                <div class="card-body">
                    <!-- ... La tabla con la informaci√≥n del proyecto se mantiene igual ... -->
                    <div class="row">
                        <div class="col-md-6">
                            <h6 class="text-muted">Informaci√≥n del Proyecto</h6>
                            <table class="table table-sm table-borderless">
                                <tbody>
                                <tr>
                                    <td class="fw-bold text-muted">Nombre de la obra:</td>
                                    <td th:text="${proyecto.nombreObra}"></td>
                                </tr>
                                <tr>
                                    <td class="fw-bold text-muted">Direcci√≥n:</td>
                                    <td th:text="${proyecto.direccionObra}"></td>
                                </tr>
                                <tr>
                                    <td class="fw-bold text-muted">Estado:</td>
                                    <td>
                                        <span class="badge"
                                              th:class="${proyecto.estado == 'ACTIVO' ? 'badge bg-success' :
                                                                proyecto.estado == 'PAUSADO' ? 'badge bg-warning text-dark' :
                                                                proyecto.estado == 'FINALIZADO' ? 'badge bg-info' :
                                                                'badge bg-secondary'}"
                                              th:text="${proyecto.estado}"></span>
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="col-md-6">
                            <h6 class="text-muted">Informaci√≥n del Cliente</h6>
                            <table class="table table-sm table-borderless">
                                <tbody>
                                <tr>
                                    <td class="fw-bold text-muted">Cliente:</td>
                                    <td th:text="${proyecto.nombreCliente}"></td>
                                </tr>
                                <tr>
                                    <td class="fw-bold text-muted">NIT:</td>
                                    <td>
                                        <code th:text="${proyecto.nitCliente}"></code>
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Formulario de confirmaci√≥n -->
            <div class="card mt-4">
                <div class="card-body">
                    <!-- ARREGLO #1: Se a√±ade th:data-nombre-obra para que el script funcione -->
                    <form th:action="@{/proyectos/eliminar}" method="post" id="formEliminar" th:data-nombre-obra="${proyecto.nombreObra}">
                        <input type="hidden" th:name="id" th:value="${proyecto.id}">
                        <div class="mb-3">
                            <label for="confirmacion" class="form-label fw-bold">
                                Para confirmar la eliminaci√≥n, escriba el nombre exacto de la obra:
                            </label>
                            <div class="input-group">
                                <span class="input-group-text"><i class="bi bi-shield-lock"></i></span>
                                <input type="text" class="form-control" id="confirmacion" name="confirmacion"
                                       th:placeholder="${proyecto.nombreObra}" autocomplete="off" required>
                            </div>
                            <div class="form-text">
                                Escriba exactamente: <strong th:text="${proyecto.nombreObra}"></strong>
                            </div>
                        </div>

                        <!-- ARREGLO #2: Se elimin√≥ el bot√≥n "Editar en su lugar" -->
                        <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                            <a th:href="@{/proyectos}" class="btn btn-outline-secondary me-md-2">
                                <i class="bi bi-x-circle"></i> Cancelar
                            </a>
                            <button type="submit" class="btn btn-danger" id="btnEliminar" disabled>
                                <i class="bi bi-trash"></i> Eliminar Definitivamente
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Footer original de esta vista -->
<footer class="bg-dark text-white mt-5 py-4">
    <div class="container text-center">
        <p class="mb-0">
            <i class="bi bi-mortarboard"></i>
            SENA - An√°lisis y Desarrollo de Software |
            <i class="bi bi-person"></i> Nelson Rodriguez |
            <i class="bi bi-calendar"></i> 2025
        </p>
    </div>
</footer>

<!-- Bootstrap 5 JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<!-- ARREGLO #1: SCRIPT CORREGIDO PARA QUE EL BOT√ìN SE ACTIVE -->
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const form = document.getElementById('formEliminar');
        // Leemos el nombre desde el atributo data-* del formulario, es m√°s seguro
        const nombreObraCorrecto = form.dataset.nombreObra;
        const inputConfirmacion = document.getElementById('confirmacion');
        const btnEliminar = document.getElementById('btnEliminar');

        inputConfirmacion.focus();

        inputConfirmacion.addEventListener('input', function() {
            // Comparamos el valor del input con el nombre del proyecto.
            const coincide = this.value.trim() === nombreObraCorrecto;
            // Habilitamos o deshabilitamos el bot√≥n seg√∫n la coincidencia.
            btnEliminar.disabled = !coincide;
        });

        form.addEventListener('submit', function(e) {
            // Doble confirmaci√≥n final
            if (!confirm('¬øEst√° absolutamente seguro de que desea eliminar este proyecto?\n\nEsta acci√≥n es IRREVERSIBLE.')) {
                e.preventDefault(); // Si el usuario cancela, no se env√≠a el formulario.
                return;
            }
            // Si el usuario confirma, el formulario se env√≠a.
            btnEliminar.innerHTML = '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Eliminando...';
            btnEliminar.disabled = true;
        });
    });
</script>

</body>
</html>
<!--
================================================================================
DOCUMENTACI√ìN COMPLETA DE confirmar-eliminar.html
================================================================================

PROP√ìSITO:
----------
Vista Thymeleaf que implementa una p√°gina de confirmaci√≥n segura antes de eliminar
un proyecto. Proporciona m√∫ltiples niveles de confirmaci√≥n y alternativas para
prevenir eliminaciones accidentales, siguiendo las mejores pr√°cticas de UX
para acciones destructivas.

INFORMACI√ìN ACAD√âMICA:
----------------------
Programa:     An√°lisis y Desarrollo de Software - SENA
Evidencia:    GA7-220501096-AA3-EV01
Tecnolog√≠a:   Thymeleaf + Bootstrap 5 + JavaScript
Ubicaci√≥n:    src/main/resources/templates/proyectos/confirmar-eliminar.html
Autor:        Nelson Rodriguez

FLUJO DE ELIMINACI√ìN:
--------------------
1. Usuario hace clic en "Eliminar" en la lista de proyectos
2. GET /proyectos/eliminar/{id} ‚Üí Muestra esta vista de confirmaci√≥n
3. Usuario ve todos los datos del proyecto a eliminar
4. Usuario tiene m√∫ltiples opciones:
   - Cancelar (bot√≥n verde, auto-focus)
   - Pausar proyecto (alternativa)
   - Cancelar proyecto (alternativa)
   - Eliminar permanentemente (bot√≥n rojo)
5. Si elige eliminar ‚Üí prompt JavaScript solicita escribir "ELIMINAR"
6. Si confirma ‚Üí POST /proyectos/eliminar ‚Üí Eliminaci√≥n real
7. Redirect a lista con mensaje de confirmaci√≥n

COMPONENTES DE SEGURIDAD UX:
---------------------------

1. ALERTAS VISUALES:
   - Alert danger prominente con advertencia
   - Iconos de advertencia en m√∫ltiples lugares
   - Colores rojos para elementos destructivos
   - Texto claro sobre irreversibilidad

2. INFORMACI√ìN COMPLETA:
   - Todos los datos del proyecto visibles
   - ID, nombre, cliente, contactos, estado
   - D√≠as transcurridos desde creaci√≥n
   - Estado actual con badges de colores

3. CONFIRMACI√ìN DOBLE:
   - Primera confirmaci√≥n: clic en bot√≥n rojo
   - Segunda confirmaci√≥n: prompt con palabra clave "ELIMINAR"
   - Loading state mientras procesa

4. ALTERNATIVAS CLARAS:
   - Bot√≥n verde "No, Mantener Proyecto" (auto-focus)
   - Opciones para pausar o cancelar en lugar de eliminar
   - Links para volver a lista sin eliminar

5. PREVENCI√ìN DE ERRORES:
   - Auto-focus en bot√≥n de cancelar
   - Warning al intentar salir de la p√°gina
   - Deshabilitaci√≥n de bot√≥n tras hacer clic
   - Loading spinner durante procesamiento

BINDING CON EL CONTROLADOR:
--------------------------

1. DATOS RECIBIDOS:
   ${proyecto}: Objeto completo del proyecto a eliminar
   Todos los campos disponibles para mostrar informaci√≥n

2. FORMULARIO DE ELIMINACI√ìN:
   POST a /proyectos/eliminar
   Campo hidden "id" con el ID del proyecto
   onclick="return confirmarEliminacion()" para validaci√≥n JS

3. FORMULARIOS DE ALTERNATIVAS:
   POST a /proyectos/cambiar-estado
   Campos: id + nuevoEstado (PAUSADO/CANCELADO)

ELEMENTOS VISUALES:
------------------

1. NAVBAR CONSISTENTE:
   - Mismo navbar que otras vistas
   - Link de regreso a lista de proyectos

2. ENCABEZADO DISTINTIVO:
   - T√≠tulo rojo con icono de advertencia
   - Subt√≠tulo explicativo
   - Bot√≥n de escape prominente

3. TARJETA PRINCIPAL:
   - Border rojo para indicar peligro
   - Header rojo con t√≠tulo claro
   - Informaci√≥n organizada en filas

4. INFORMACI√ìN DEL PROYECTO:
   - Iconos contextuales para cada campo
   - Links funcionales (email, tel√©fono)
   - Badges para estado con colores apropiados
   - Formateo de fechas legible

5. ZONA DE CONFIRMACI√ìN:
   - Background gris claro para destacar
   - Icono grande de pregunta
   - Mensaje centrado y claro
   - Nombre del proyecto resaltado

JAVASCRIPT INTERACTIVO:
----------------------

1. FUNCI√ìN confirmarEliminacion():
   - Prompt con mensaje detallado
   - Incluye nombre del proyecto y cliente
   - Requiere escribir exactamente "ELIMINAR"
   - Loading state con spinner
   - Cancelaci√≥n clara con alert

2. AUTO-FOCUS Y UX:
   - Focus autom√°tico en bot√≥n de cancelar
   - Prevenci√≥n de salida accidental (beforeunload)
   - Remoci√≥n de warning al enviar formulario

3. THYMELEAF INLINE:
   - Variables JavaScript desde Thymeleaf
   - Datos del proyecto disponibles en JS
   - Mensajes din√°micos personalizados

ALTERNATIVAS A LA ELIMINACI√ìN:
-----------------------------

1. PAUSAR PROYECTO:
   - Formulario independiente
   - Cambia estado a PAUSADO
   - Mantiene historial completo
   - Bot√≥n warning (amarillo)

2. CANCELAR PROYECTO:
   - Formulario independiente
   - Cambia estado a CANCELADO
   - Preserva datos para auditor√≠a
   - Bot√≥n outline-danger

3. MANTENER PROYECTO:
   - Link directo a lista
   - No realiza cambios
   - Bot√≥n success prominente
   - Auto-focus para seguridad

ACCESIBILIDAD:
-------------

1. SEM√ÅNTICA HTML:
   - role="alert" en alertas importantes
   - Labels y t√≠tulos descriptivos
   - Estructura de headings l√≥gica
   - Links y botones sem√°nticamente correctos

2. NAVEGACI√ìN:
   - Tab order que prioriza cancelaci√≥n
   - Shortcuts de teclado disponibles
   - Escape paths claros
   - Focus management apropiado

3. CONTRASTE Y LEGIBILIDAD:
   - Colores con contraste suficiente
   - Iconos con significado claro
   - Texto legible en todos los tama√±os
   - Estados visuales distintivos

RESPONSIVE DESIGN:
-----------------

1. GRID BOOTSTRAP:
   - Centrado en pantallas grandes (col-lg-8)
   - Adaptaci√≥n autom√°tica a m√≥viles
   - Botones apilados en pantallas peque√±as

2. COMPONENTES ADAPTATIVOS:
   - Cards responsivos
   - Botones que cambian a w-100 en m√≥viles
   - Texto que se ajusta autom√°ticamente

INTEGRACI√ìN CON BACKEND:
-----------------------

1. ENDPOINT GET /proyectos/eliminar/{id}:
   - Carga datos del proyecto
   - Valida existencia
   - Maneja errores con redirect

2. ENDPOINT POST /proyectos/eliminar:
   - Procesa eliminaci√≥n real
   - Transaccional y seguro
   - Mensaje de confirmaci√≥n

3. ENDPOINT POST /proyectos/cambiar-estado:
   - Alternativa no destructiva
   - Preserva datos completos
   - Cambio de estado auditado

CASOS DE USO CUBIERTOS:
----------------------

1. ELIMINACI√ìN INTENCIONAL:
   - Usuario confirma paso a paso
   - Informaci√≥n clara de qu√© se elimina
   - Proceso seguro y auditado

2. ELIMINACI√ìN ACCIDENTAL:
   - M√∫ltiples puntos de cancelaci√≥n
   - Auto-focus en opci√≥n segura
   - Advertencias claras

3. INDECISI√ìN DEL USUARIO:
   - Alternativas claras disponibles
   - Informaci√≥n completa para decidir
   - Opciones reversibles vs irreversibles

4. NAVEGACI√ìN INCORRECTA:
   - Links de escape prominentes
   - Warning al salir de la p√°gina
   - Breadcrumb visual claro

SEGURIDAD:
---------

1. VALIDACI√ìN DE ENTRADA:
   - ID del proyecto validado en backend
   - Verificaci√≥n de existencia
   - Manejo de proyectos inexistentes

2. CSRF PROTECTION:
   - Formularios POST con tokens autom√°ticos
   - Integraci√≥n con Spring Security preparada

3. CONFIRMACI√ìN ROBUSTA:
   - Doble confirmaci√≥n requerida
   - Palabra clave espec√≠fica
   - No eliminaci√≥n por accidente de UI

TESTING SUGERIDO:
----------------

1. FUNCIONAL:
   - Cancelaci√≥n en cada punto
   - Confirmaci√≥n correcta
   - Formularios de alternativas
   - Links de navegaci√≥n

2. UX:
   - Auto-focus funcional
   - Warnings de navegaci√≥n
   - Loading states
   - Responsive design

3. ACCESIBILIDAD:
   - Navegaci√≥n por teclado
   - Screen readers
   - Contraste de colores

EVIDENCIA DE COMPETENCIAS:
-------------------------
1. üéØ Implementaci√≥n de UX patterns para acciones destructivas
2. üèóÔ∏è Integraci√≥n completa con controladores Spring MVC
3. üíæ Manejo de formularios y validaciones JavaScript
4. üìù Dise√±o centrado en seguridad del usuario
5. üîß Responsive design y accesibilidad
6. üß™ Alternativas no destructivas implementadas
7. üìä Informaci√≥n completa y transparente

MEJORES PR√ÅCTICAS DEMOSTRADAS:
-----------------------------
- Confirmaci√≥n doble para acciones irreversibles
- Auto-focus en opci√≥n segura
- Informaci√≥n completa antes de decidir
- Alternativas claras a la eliminaci√≥n
- Feedback visual claro en cada estado
- Prevenci√≥n de errores de navegaci√≥n
- Loading states para operaciones lentas

AUTOR: Nelson Rodriguez
EVIDENCIA: GA7-220501096-AA3-EV01
FECHA: 2025-07-07
VERSI√ìN: 3.0 (Thymeleaf + UX Segura)

================================================================================
-->